<%- include('partials/htmlheader.ejs') %>

<link rel="stylesheet" href="/styles.css" />

<div id="exemptionFormContainer"
    style="max-width:400px; margin:auto; padding:20px; border:1px solid #ccc; border-radius:10px;">
    <h2>Elderly Check In Management</h2>

<label>
    Elderly Name:
    <input type="text" id="elderName" placeholder="Enter full name" required>
</label>
<br><br>

<label>
    Check-In:
    <select id="isExempt">
        <option value="TRUE">PAUSE</option>
        <option value="FALSE">RESUME</option>
    </select>
</label>
<br><br>

<label>
    Reason:
    <input type="text" id="reason" placeholder="e.g., Overseas">
</label>
<br><br>

<label>
    Start Date:
    <input type="date" id="startDate">
</label>
<br><br>

<label>
    End Date:
    <input type="date" id="endDate">
</label>
<br><br>

<button id="submitExemption">Submit</button>
<p id="exemptionMessage"></p>


</div>

<script>
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzC1cFq0qUsDzxltIpvR0qeJ431yvd9q3MV5h0HYr4o/dev';

document.getElementById('submitExemption').addEventListener('click', async () => {
    const elderName = document.getElementById('elderName').value.trim();
    const isExempt = document.getElementById('isExempt').value;
    const reason = document.getElementById('reason').value.trim();
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const msgEl = document.getElementById('exemptionMessage');

    // Simple validation
    if (!elderName) {
        msgEl.style.color = 'red';
        msgEl.textContent = "Please enter the elderly's name.";
        return;
    }

    msgEl.style.color = 'black';
    msgEl.textContent = "Submitting...";

    try {
        const response = await fetch(GAS_URL + '?action=exemption', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: elderName, isExempt, reason, startDate, endDate })
        });



        if (!response.ok) throw new Error('Network response was not OK');

        const data = await response.json();

        if (data.result === 'success') {
            msgEl.style.color = 'green';
            msgEl.textContent = data.message;
        } else {
            msgEl.style.color = 'red';
            msgEl.textContent = data.message || 'Failed to submit exemption.';
        }

    } catch (err) {
        msgEl.style.color = 'red';
        msgEl.textContent = 'Error: ' + err.message;
        console.error('Exemption submit error:', err);
    }
});
</script>

<%- include('partials/htmlfooter.ejs') %>
